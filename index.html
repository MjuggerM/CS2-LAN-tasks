<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CS2 LAN Party Pl√°novaƒç</title>
  <link rel="stylesheet" href="styles_css.css" />
  <!-- Firebase knihovny -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    // ---- Firebase config ----
    const firebaseConfig = {
      apiKey: "AIzaSyBYKi2hMqT8SaBzgzJozxsA_Hvb_qNGCMc",
      authDomain: "cs2checklist.firebaseapp.com",
      databaseURL: "https://cs2checklist-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cs2checklist",
      storageBucket: "cs2checklist.appspot.com",
      messagingSenderId: "499983568529",
      appId: "1:499983568529:web:efa1d26ece5804abc2b930",
      measurementId: "G-DPN9HWTLPS"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ---- DATA ----
    const teamMembers = [
      { name: 'Radim', avatar: 'R', photo: 'radimgod.jpg' },
      { name: 'Doriman', avatar: 'D', photo: 'doriman.jpg' },
      { name: 'Bur√°k', avatar: 'B', photo: 'burak.jpg' },
      { name: 'Kinigi', avatar: 'K', photo: 'kinigi.jpg' },
      { name: 'Sejr', avatar: 'S', photo: 'sejr.jpg' }
    ];

    const individualChecklistItems = [
      "PC", "Monitor", "My≈°", "Kl√°vesnice", "Podlo≈æka"
    ];

    const initialData = {
      buy: [
        { id: 1, text: 'Ethernet kabely', completed: false, assignedTo: 'Radim' },
        { id: 2, text: 'Switch/hub', completed: false, assignedTo: 'Doriman' },
        { id: 3, text: 'J√≠dlo a pit√≠', completed: false, assignedTo: 'Bur√°k' },
        { id: 4, text: 'Prodlu≈æovac√≠ kabely', completed: false, assignedTo: null }
      ],
      solve: [
        { id: 5, text: 'Domluvit m√≠sto kon√°n√≠', completed: false, assignedTo: 'Kinigi' },
        { id: 6, text: 'Vybrat datum', completed: false, assignedTo: 'Sejr' },
        { id: 7, text: 'Zkontrolovat internet', completed: false, assignedTo: 'Radim' },
        { id: 8, text: 'Nastavit CS2 server', completed: false, assignedTo: null }
      ],
      individual: Object.fromEntries(
        teamMembers.map(member => [
          member.name,
          Object.fromEntries(individualChecklistItems.map(i => [i, false]))
        ])
      ),
    };

    // ---- HOOK: Realtime sync s Firebase ----
    const { useState, useRef, useEffect, memo } = React;
    function useLanPartyData() {
      const [items, setItems] = useState(initialData);

      // Naƒç√≠t√°n√≠ ze serveru
      useEffect(() => {
        const ref = db.ref('cs2checklist/items');
        ref.on('value', snapshot => {
          const val = snapshot.val();
          if (val) setItems(val);
        });
        ref.once('value', snapshot => {
          if (!snapshot.exists()) ref.set(initialData);
        });
        return () => ref.off();
      }, []);

      const saveToDB = (newItems) => db.ref('cs2checklist/items').set(newItems);

      const addItem = (category, text, assignedTo) => {
        const newItem = {
          id: Date.now() + Math.floor(Math.random()*1000),
          text,
          completed: false,
          assignedTo,
          editing: false
        };
        const updated = {
          ...items,
          [category]: [...(items[category] || []), newItem]
        };
        saveToDB(updated);
      };

      const toggleItem = (category, id) => {
        const updated = {
          ...items,
          [category]: items[category].map(item =>
            item.id === id ? { ...item, completed: !item.completed } : item
          )
        };
        saveToDB(updated);
      };

      const editItem = (category, id) => {
        const updated = {
          ...items,
          [category]: items[category].map(item =>
            item.id === id ? { ...item, editing: true } : item
          )
        };
        saveToDB(updated);
      };

      const saveEdit = (category, id, text, assignedTo) => {
        const updated = {
          ...items,
          [category]: items[category].map(item =>
            item.id === id ? { ...item, text, assignedTo, editing: false } : item
          )
        };
        saveToDB(updated);
      };

      const cancelEdit = (category, id) => {
        const updated = {
          ...items,
          [category]: items[category].map(item =>
            item.id === id ? { ...item, editing: false } : item
          )
        };
        saveToDB(updated);
      };

      const deleteItem = (category, id) => {
        const updated = {
          ...items,
          [category]: items[category].filter(item => item.id !== id)
        };
        saveToDB(updated);
      };

      // --- INDIVIDUAL CHECKLIST (p≈ôep√≠n√°n√≠) ---
      const toggleIndividual = (user, itemName) => {
        const updated = {
          ...items,
          individual: {
            ...items.individual,
            [user]: {
              ...items.individual[user],
              [itemName]: !items.individual[user][itemName]
            }
          }
        };
        saveToDB(updated);
      };

      return {
        items,
        addItem,
        toggleItem,
        editItem,
        saveEdit,
        cancelEdit,
        deleteItem,
        toggleIndividual,
      };
    }

    // --- Ostatn√≠ komponenty jsou stejn√© jako v√Ω≈°e ---
    const Avatar = memo(function Avatar({ photo, avatar, className = "" }) {
      return (
        <div
          className={className + (photo ? " photo" : "")}
          style={photo ? { backgroundImage: `url(${photo})` } : undefined}
        >
          {!photo && avatar}
        </div>
      );
    });

    const TeamMember = memo(function TeamMember({ member }) {
      return (
        <div className="team-member">
          <Avatar photo={member.photo} avatar={member.avatar} className="team-member-avatar" />
          <div className="team-member-name">{member.name}</div>
        </div>
      );
    });

    const PersonSelect = memo(function PersonSelect({ value, onChange }) {
      return (
        <select className="person-select" value={value} onChange={onChange}>
          <option value="">Nep≈ôi≈ôazeno</option>
          {teamMembers.map(member => (
            <option key={member.name} value={member.name}>{member.name}</option>
          ))}
        </select>
      );
    });

    const PersonAvatar = memo(function PersonAvatar({ personName }) {
      const person = teamMembers.find(member => member.name === personName);
      if (!person) return null;
      return (
        <div className="item-person">
          <Avatar photo={person.photo} avatar={person.avatar} className="person-avatar" />
          <span>{person.name}</span>
        </div>
      );
    });

    const EditForm = memo(function EditForm({ item, category, onSave, onCancel }) {
      const [text, setText] = useState(item.text);
      const [assignedTo, setAssignedTo] = useState(item.assignedTo || "");
      const inputRef = useRef(null);

      useEffect(() => { if (inputRef.current) inputRef.current.focus(); }, []);

      return (
        <div className="edit-form">
          <input
            ref={inputRef}
            type="text"
            value={text}
            onChange={e => setText(e.target.value)}
            maxLength="100"
            onKeyDown={e => { if (e.key === "Enter") onSave(item.id, text, assignedTo); if (e.key === "Escape") onCancel(item.id); }}
          />
          <PersonSelect value={assignedTo} onChange={e => setAssignedTo(e.target.value)} />
          <div className="edit-form-actions">
            <button className="action-btn save-btn" onClick={() => onSave(item.id, text, assignedTo)}>Ulo≈æit</button>
            <button className="action-btn cancel-btn" onClick={() => onCancel(item.id)}>Zru≈°it</button>
          </div>
        </div>
      );
    });

    const ListItem = memo(function ListItem({ item, category, onToggle, onEdit, onDelete, onSaveEdit, onCancelEdit }) {
      return (
        <li className={"item" + (item.completed ? " completed" : "")}>
          <input
            type="checkbox"
            checked={item.completed}
            onChange={() => onToggle(item.id)}
            disabled={item.editing}
          />
          <div className="item-content">
            {item.editing ? (
              <EditForm
                item={item}
                category={category}
                onSave={onSaveEdit}
                onCancel={onCancelEdit}
              />
            ) : (
              <>
                <span className="item-text">{item.text}</span>
                {item.assignedTo && <PersonAvatar personName={item.assignedTo} />}
              </>
            )}
          </div>
          <div className="item-actions">
            {!item.editing && (
              <>
                <button className="action-btn edit-btn" onClick={() => onEdit(item.id)}>Upravit</button>
                <button className="action-btn delete-btn" onClick={() => onDelete(item.id)}>Smazat</button>
              </>
            )}
          </div>
        </li>
      );
    });

    const AddItemForm = memo(function AddItemForm({ category, onAdd }) {
      const [text, setText] = useState('');
      const [assignedTo, setAssignedTo] = useState('');
      const inputRef = useRef(null);

      const handleSubmit = () => {
        if (text.trim()) {
          onAdd(category, text.trim(), assignedTo || null);
          setText('');
          setAssignedTo('');
          if (inputRef.current) inputRef.current.focus();
        }
      };

      return (
        <div className="add-item">
          <div className="add-item-row">
            <input
              ref={inputRef}
              type="text"
              value={text}
              onChange={e => setText(e.target.value)}
              onKeyDown={e => { if (e.key === "Enter") handleSubmit(); }}
              placeholder={category === 'buy' ? 'P≈ôidat polo≈æku k sehn√°n√≠...' : 'P≈ôidat √∫kol k vy≈ôe≈°en√≠...'}
              maxLength="100"
            />
            <PersonSelect value={assignedTo} onChange={e => setAssignedTo(e.target.value)} />
            <button className="add-btn" onClick={handleSubmit}>P≈ôidat</button>
          </div>
        </div>
      );
    });

    const ProgressStats = memo(function ProgressStats({ items }) {
      const total = items.length;
      const completed = items.filter(item => item.completed).length;
      const percentage = total > 0 ? (completed / total) * 100 : 0;
      return (
        <div className="stats">
          <div>Dokonƒçeno: {completed} / {total}</div>
          <div className="progress-bar">
            <div className="progress-fill" style={{ width: percentage + "%" }}></div>
          </div>
        </div>
      );
    });

    const ListSection = memo(function ListSection({ title, emoji, category, items, onAdd, onToggle, onEdit, onDelete, onSaveEdit, onCancelEdit }) {
      return (
        <div className="section">
          <h2>{emoji} {title}</h2>
          <AddItemForm category={category} onAdd={onAdd} />
          <ul className="items-list">
            {items.map(item => (
              <ListItem
                key={item.id}
                item={item}
                category={category}
                onToggle={onToggle}
                onEdit={onEdit}
                onDelete={onDelete}
                onSaveEdit={onSaveEdit}
                onCancelEdit={onCancelEdit}
              />
            ))}
          </ul>
          <ProgressStats items={items} />
        </div>
      );
    });

    // ---- INDIVIDUAL CHECKLIST ----
    function IndividualChecklists({ state, onToggle }) {
      return (
        <div className="individual-checklists-main">
          <h2 className="individual-checklists-title">üéí Individu√°ln√≠ checklisty</h2>
          <div className="individual-checklists">
            {teamMembers.map(member => (
              <div className="individual-checklist" key={member.name}>
                <div className="individual-title">
                  <Avatar photo={member.photo} avatar={member.avatar} className="team-member-avatar" />
                  <span>{member.name}</span>
                </div>
                <ul>
                  {individualChecklistItems.map(item => (
                    <li key={item}>
                      <input
                        type="checkbox"
                        checked={!!(state?.[member.name]?.[item])}
                        onChange={() => onToggle(member.name, item)}
                        id={`check-${member.name}-${item}`}
                      />
                      <label htmlFor={`check-${member.name}-${item}`}>{item}</label>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ---- MAIN APP (GRID) ----
    function CS2LanPlanner() {
      const { items, addItem, toggleItem, editItem, saveEdit, cancelEdit, deleteItem, toggleIndividual } = useLanPartyData();

      return (
        <div className="container">
          <div className="header">
            <h1>CS2 LAN Party Pl√°novaƒç</h1>
          </div>
          <div className="content-grid">
            <div className="content-cell"><ListSection
                title="Vƒõci k sehn√°n√≠/koupen√≠"
                emoji="üõçÔ∏è"
                category="buy"
                items={items.buy || []}
                onAdd={addItem}
                onToggle={id => toggleItem('buy', id)}
                onEdit={id => editItem('buy', id)}
                onDelete={id => deleteItem('buy', id)}
                onSaveEdit={(id, text, assignedTo) => saveEdit('buy', id, text, assignedTo)}
                onCancelEdit={id => cancelEdit('buy', id)}
            /></div>
            <div className="content-cell"><ListSection
                title="Vƒõci k vy≈ôe≈°en√≠/zji≈°tƒõn√≠"
                emoji="üìã"
                category="solve"
                items={items.solve || []}
                onAdd={addItem}
                onToggle={id => toggleItem('solve', id)}
                onEdit={id => editItem('solve', id)}
                onDelete={id => deleteItem('solve', id)}
                onSaveEdit={(id, text, assignedTo) => saveEdit('solve', id, text, assignedTo)}
                onCancelEdit={id => cancelEdit('solve', id)}
            /></div>
            <div className="content-row-bottom" style={{ gridColumn: "1 / span 2" }}>
              <IndividualChecklists
                state={items.individual || {}}
                onToggle={toggleIndividual}
              />
            </div>
          </div>
          <div className="section team-section">
            <h2>üë• T√Ωm</h2>
            <div className="team-members">
              {teamMembers.map(member => (
                <TeamMember key={member.name} member={member} />
              ))}
            </div>
          </div>
        </div>
      );
    }

    // ---- RENDER ----
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<CS2LanPlanner />);
  </script>
</body>
</html>
